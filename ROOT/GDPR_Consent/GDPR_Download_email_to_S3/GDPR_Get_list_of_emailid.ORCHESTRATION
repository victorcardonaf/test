{"job":{"components":{"877653":{"id":877653,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1245,"y":-187,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[877671],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877654":{"id":877654,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-743,"y":-195,"width":32,"height":32,"inputConnectorIDs":[877668],"outputSuccessConnectorIDs":[877670],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"read from conf. table and update variable"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import datetime \nimport pytz\ncursor = context.cursor()\n\nnow = datetime.datetime.now()\n\nprint now \ncursor.execute(\"select startvalue, endvalue  from  public.etl_configuration where 1=1 and processname ='%s' \" %processname)\ndata = cursor.fetchone()\n#print data\nlast_run_start = data[0]\nlast_run_end = data[1]\nprint 'last_run_start : ' , last_run_start \nprint 'last_run_end: ' , last_run_end\n\ncontext.updateVariable('start', last_run_end)\ncontext.updateVariable('end', now)\n#print 'processname ',processname\nprint 'current_run_start : ' , start \n#print 'current_run_end: ' , end\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877655":{"id":877655,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-205266581,"x":-470,"y":-189,"width":32,"height":32,"inputConnectorIDs":[877670],"outputSuccessConnectorIDs":[877664],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get List of email id since last run"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INBOX"}}}},"visible":true},"7":{"slot":7,"name":"Data Selection","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"From"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"Attachments"}}}},"visible":true},"8":{"slot":8,"name":"Data Source Filter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Date"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"'${start}'"}}}},"visible":true},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT Id as MsgId,date as  email_date,\"from\" as sender\nFROM Inbox\nWHERE  1=1\nand date >= '${start}'\nand date < '${end}'\n"}}}},"visible":false},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"5000"}}}},"visible":true},"12":{"slot":12,"name":"Connection Options","elements":{},"visible":true},"13":{"slot":13,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tmp_gdpr_consent_Listof_emailID"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"15":{"slot":15,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"16":{"slot":16,"name":"Sort Key","elements":{},"visible":true},"17":{"slot":17,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true},"18":{"slot":18,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"19":{"slot":19,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"geniussports-dmp-bi-prod"}}}},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"21":{"slot":21,"name":"Primary Key","elements":{},"visible":true},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"100":{"slot":100,"name":"IMAP Server","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"imap.outlook.com"}}}},"visible":true},"101":{"slot":101,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GDPRConsent@geniussports.com"}}}},"visible":true},"102":{"slot":102,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Dafne01@"}}}},"visible":true},"103":{"slot":103,"name":"IMAP Port","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"993"}}}},"visible":true},"104":{"slot":104,"name":"Provider","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Outlook"}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"3"}}}},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877656":{"id":877656,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":1227580116,"x":-471,"y":36,"width":32,"height":16,"inputConnectorIDs":[877667],"outputSuccessConnectorIDs":[877669],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Table Iterator 0"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tmp_gdpr_consent_Listof_emailID"}}}},"visible":true},"3":{"slot":3,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"},"2":{"slot":2,"type":"STRING","value":"email_id"}}}},"visible":true},"4":{"slot":4,"name":"Ordering","elements":{},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true},"7":{"slot":7,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"9":{"slot":9,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[877672],"inputIterationConnectorIDs":[]},"877657":{"id":877657,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-216,"y":-87,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GDPR_map_emailattchemt_prefix_with_etl_configuration"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GDPR_map_emailattchemt_prefix_with_etl_configuration"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[877672]},"877658":{"id":877658,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-1029,"y":-195,"width":32,"height":32,"inputConnectorIDs":[877671],"outputSuccessConnectorIDs":[877668],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create tmp_gdpr_consent_attachments_detail"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists loading.tmp_gdpr_consent_attachments_detail ;\ncreate table if not exists loading.tmp_gdpr_consent_attachments_detail (\n  id          bigint,\n  attachments varchar(1000),\n  fileprefix  varchar(100),\n  s3_bucket   varchar(1000) ,\n  processname varchar(1000)\n) ;\ncreate table if not exists loading.tmp_gdpr_consent_Listof_emailID (\n  id          bigint,\n  date\t\t  timestamp,\n  \"from\"\t  varchar(100),\n  attachments varchar(1000)\n) ;\ntruncate table loading.tmp_gdpr_consent_Listof_emailID;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877659":{"id":877659,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-461,"y":-68,"width":32,"height":32,"inputConnectorIDs":[877664],"outputSuccessConnectorIDs":[877667],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete file without attachement"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/*\ndelete  from loading.tmp_gdpr_consent_Listof_emailID\nwhere 1=1\nand len(attachments) = 0;\n\n*/"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877660":{"id":877660,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-465,"y":156,"width":32,"height":32,"inputConnectorIDs":[877669],"outputSuccessConnectorIDs":[877666],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get s3 bucket and process name based on prefix"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update loading.tmp_gdpr_consent_attachments_detail\n    set s3_bucket = et.src_url ,\n    processname = et.processname\nfrom public.etl_configuration et\nwhere  1=1\n  and lower(loading.tmp_gdpr_consent_attachments_detail.fileprefix) = lower(et.src_prefix)\n  and  et.processname ilike '%GDPR_Consent_%' ;\n  \nupdate loading.tmp_gdpr_consent_attachments_detail\n    set s3_bucket = 'geniussports-gdprconsent-bi-prod' \nwhere  1=1\n and s3_bucket is null ;\n\n\n  \n  /*\ndelete  from loading.tmp_gdpr_consent_attachments_detail\nwhere 1=1\nand s3_bucket is null ;\n*/"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877661":{"id":877661,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":1227580116,"x":-468,"y":226,"width":32,"height":16,"inputConnectorIDs":[877666],"outputSuccessConnectorIDs":[877665],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Table Iterator 1"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"tmp_gdpr_consent_attachments_detail"}}}},"visible":true},"3":{"slot":3,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"},"2":{"slot":2,"type":"STRING","value":"email_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"s3_bucket"},"2":{"slot":2,"type":"STRING","value":"src_url"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"attachments"},"2":{"slot":2,"type":"STRING","value":"attachments"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fileprefix"},"2":{"slot":2,"type":"STRING","value":"src_folder"}}}},"visible":true},"4":{"slot":4,"name":"Ordering","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true},"7":{"slot":7,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"9":{"slot":9,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[877673],"inputIterationConnectorIDs":[]},"877662":{"id":877662,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-468,"y":226,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GDPR_download_attachement_to_s3"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"GDPR_download_attachement_to_s3"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[877673]},"877663":{"id":877663,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-458,"y":345,"width":32,"height":32,"inputConnectorIDs":[877665],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update last process value"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\nupdate public.etl_configuration\n  set startvalue = (select coalesce(min(date),getdate()-1) from loading.tmp_gdpr_consent_Listof_emailID)\n,endvalue = (select coalesce(max(date),'${end}') from loading.tmp_gdpr_consent_Listof_emailID)\nwhere 1=1 \nand processname  ='${processname}'\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"877669":{"id":877669,"sourceID":877656,"targetID":877660},"877668":{"id":877668,"sourceID":877658,"targetID":877654},"877670":{"id":877670,"sourceID":877654,"targetID":877655},"877665":{"id":877665,"sourceID":877661,"targetID":877663},"877664":{"id":877664,"sourceID":877655,"targetID":877659},"877667":{"id":877667,"sourceID":877659,"targetID":877656},"877666":{"id":877666,"sourceID":877660,"targetID":877661}},"failureConnectors":{},"unconditionalConnectors":{"877671":{"id":877671,"sourceID":877653,"targetID":877658}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"877673":{"id":877673,"sourceID":877661,"targetID":877662},"877672":{"id":877672,"sourceID":877656,"targetID":877657}},"noteConnectors":{},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"variables":{"start":{"definition":{"name":"start","type":"DATETIME","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"2018-01-01"},"end":{"definition":{"name":"end","type":"DATETIME","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"2018-01-02"}},"grids":{}},"info":{"name":"GDPR_Get_list_of_emailid","description":" ","type":"ORCHESTRATION"}}