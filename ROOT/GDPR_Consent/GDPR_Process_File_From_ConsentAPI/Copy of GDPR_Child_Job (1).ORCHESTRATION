{"job":{"components":{"877706":{"id":877706,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1184,"y":-215,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[877722],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877707":{"id":877707,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1449697230,"x":-817,"y":-66,"width":32,"height":32,"inputConnectorIDs":[877717],"outputSuccessConnectorIDs":[877715],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Row Count","mapTo":"rowcount"},"2":{"slot":2,"fromId":null,"fromName":"Message","mapTo":"message"},"3":{"slot":3,"fromId":null,"fromName":"Status","mapTo":"status"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load data from S3 to Stage table"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stagetablename}"}}}},"visible":true},"3":{"slot":3,"name":"Load Columns","elements":{},"visible":true},"4":{"slot":4,"name":"S3 URL Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://${src_url}"}}}},"visible":true},"5":{"slot":5,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${filename}"}}}},"visible":true},"6":{"slot":6,"name":"Data File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"7":{"slot":7,"name":"Fixed Width Spec","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":","}}}},"visible":true},"9":{"slot":9,"name":"CSV Quoter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\""}}}},"visible":true},"10":{"slot":10,"name":"JSON Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false},"11":{"slot":11,"name":"S3 Bucket Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"13":{"slot":13,"name":"Compression Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${compression}"}}}},"visible":true},"14":{"slot":14,"name":"Encoding","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UTF8"}}}},"visible":true},"15":{"slot":15,"name":"Remove Quotes","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"16":{"slot":16,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"?"}}}},"visible":true},"17":{"slot":17,"name":"Maximum Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"18":{"slot":18,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"19":{"slot":19,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"20":{"slot":20,"name":"Ignore Header Rows","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"1"}}}},"visible":true},"21":{"slot":21,"name":"Accept Any Date","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"22":{"slot":22,"name":"Ignore Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"23":{"slot":23,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"24":{"slot":24,"name":"Fill Record","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"25":{"slot":25,"name":"Trim Blanks","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"26":{"slot":26,"name":"NULL As","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\\\\N"}}}},"visible":true},"27":{"slot":27,"name":"Empty As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"28":{"slot":28,"name":"Blanks As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"29":{"slot":29,"name":"Comp Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"30":{"slot":30,"name":"Stat Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"31":{"slot":31,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"32":{"slot":32,"name":"Round Decimals","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"33":{"slot":33,"name":"Manifest","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"34":{"slot":34,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true},"35":{"slot":35,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"36":{"slot":36,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"37":{"slot":37,"name":"Explicit IDs","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"38":{"slot":38,"name":"IAM Role ARN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"arn:aws:iam::<aws-account-id>:role/<role-name>"}}}},"visible":true},"112":{"slot":112,"name":"Avro Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877708":{"id":877708,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-448,"y":60,"width":32,"height":32,"inputConnectorIDs":[877718],"outputSuccessConnectorIDs":[877716],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim consent"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into consent.dim_consent (\n\n  accountid,\n  clientid,\n  client_purpose_id,\n  iab_purpose_id ,\n  consentprovided,\n  consentdate,\n  filename,\n  batchid\n)\n\n\n\n\nSELECT distinct \n  stg.accountid,\n  stg.clientid,\n  coalesce(dp.client_purpose_id,0)as client_purpose_id,\n  coalesce(cpm.iab_purpose_id,0)as iab_purpose_id,\n  stg.consentprovided,\n  stg.updatedate AS consentdate,\n  '${filename}'  as filename,\n  '${BatchId}'   as batchid\nFROM loading.${stagetablename} AS stg\n  left  JOIN\n  consent.dim_client_purpose AS dp\n    ON lower(stg.purpose) = lower(dp.purpose) \n    left join  consent.iab_client_purpose_mapping  cpm\n    on dp.client_purpose_id = cpm.client_purpose_id and cpm.active = true"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877709":{"id":877709,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1074,"y":-177,"width":32,"height":32,"inputConnectorIDs":[877722],"outputSuccessConnectorIDs":[877721],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get client id and chk if the file is gzip"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"context.updateVariable('stagetablename','tmp_Gdpr_kinesis_consent' )\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877710":{"id":877710,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-600,"y":47,"width":32,"height":32,"inputConnectorIDs":[877719],"outputSuccessConnectorIDs":[877718],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client_purpose and purpose_mapping"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into consent.dim_client_purpose(purpose)\nSELECT\n  distinct lower(st.purpose) as purpose \nFROM \"loading\".${stagetablename} st\nwhere not exists \n\t(\n      \tselect null \n      \tfrom \n      \tconsent.dim_client_purpose dcp where lower(st.purpose) = lower(dcp.purpose)\n\t) ;\n   \n--insert default purpose\ninsert into consent.iab_client_purpose_mapping( client_purpose_id ,iab_purpose_id)\nselect distinct cp.client_purpose_id , 1 as  iab_purpose_id  ---Storage and access of information\nfrom \"loading\".${stagetablename} sg\n  join consent.dim_client_purpose cp\n    on lower(sg.purpose) = lower(cp.purpose)\nwhere not exists(select null\n                 from consent.iab_client_purpose_mapping iab\n                 where cp.client_purpose_id =  iab.client_purpose_id\n                       and iab.iab_purpose_id = 1) ;\n\n\ninsert into consent.iab_client_purpose_mapping( client_purpose_id ,iab_purpose_id)\nselect distinct cp.client_purpose_id , 3  as  iab_purpose_id  --Ad selection, delivery, reporting\nfrom \"loading\".${stagetablename} sg\n  join consent.dim_client_purpose cp\n    on lower(sg.purpose) = lower(cp.purpose)\nwhere not exists(select null\n                 from consent.iab_client_purpose_mapping iab\n                 where cp.client_purpose_id = iab.client_purpose_id\n                       and iab.iab_purpose_id = 3); "}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877711":{"id":877711,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-342,"y":89,"width":32,"height":32,"inputConnectorIDs":[877716],"outputSuccessConnectorIDs":[877720],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fact_Consent"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fact_Consent"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877712":{"id":877712,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-201,"y":113,"width":32,"height":32,"inputConnectorIDs":[877720],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update status"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\t\ninsert into etl_inbound_log\n(processname, batchid, path, filename, rowcount, status, message)\nvalues ('${processname}','${BatchId}','${src_url}','${filename}',${rowcount},'${status}','${message}')\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877713":{"id":877713,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-706,"y":-4,"width":32,"height":32,"inputConnectorIDs":[877715],"outputSuccessConnectorIDs":[877719],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877714":{"id":877714,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-931,"y":-121,"width":32,"height":32,"inputConnectorIDs":[877721],"outputSuccessConnectorIDs":[877717],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"create stage table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"drop table if exists loading.${stagetablename};\ncreate table loading.${stagetablename}\n(\n\tclientid varchar(100),\n\taccountid varchar(100),\n\tupdatedate varchar(100),\n\tconsentprovided boolean,\n\tpurpose varchar(100)\n);\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"877721":{"id":877721,"sourceID":877709,"targetID":877714},"877720":{"id":877720,"sourceID":877711,"targetID":877712},"877717":{"id":877717,"sourceID":877714,"targetID":877707},"877716":{"id":877716,"sourceID":877708,"targetID":877711},"877719":{"id":877719,"sourceID":877713,"targetID":877710},"877718":{"id":877718,"sourceID":877710,"targetID":877708},"877715":{"id":877715,"sourceID":877707,"targetID":877713}},"failureConnectors":{},"unconditionalConnectors":{"877722":{"id":877722,"sourceID":877706,"targetID":877709}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"variables":{"compression":{"definition":{"name":"compression","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"None"},"rowcount":{"definition":{"name":"rowcount","type":"DECIMAL","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"0"},"message":{"definition":{"name":"message","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":""},"status":{"definition":{"name":"status","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"Copy of GDPR_Child_Job (1)","description":"","type":"ORCHESTRATION"}}