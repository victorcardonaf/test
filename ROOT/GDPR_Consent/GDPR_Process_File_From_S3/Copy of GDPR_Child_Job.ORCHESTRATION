{"job":{"components":{"877725":{"id":877725,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1184,"y":-215,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[877743],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877726":{"id":877726,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1449697230,"x":-828,"y":-57,"width":32,"height":32,"inputConnectorIDs":[877738],"outputSuccessConnectorIDs":[877737],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Row Count","mapTo":"rowcount"},"2":{"slot":2,"fromId":null,"fromName":"Message","mapTo":"message"},"3":{"slot":3,"fromId":null,"fromName":"Status","mapTo":"status"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load data from S3 to Stage table"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stagetablename}"}}}},"visible":true},"3":{"slot":3,"name":"Load Columns","elements":{},"visible":true},"4":{"slot":4,"name":"S3 URL Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://${src_url}"}}}},"visible":true},"5":{"slot":5,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${filename}"}}}},"visible":true},"6":{"slot":6,"name":"Data File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"7":{"slot":7,"name":"Fixed Width Spec","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":","}}}},"visible":true},"9":{"slot":9,"name":"CSV Quoter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\""}}}},"visible":true},"10":{"slot":10,"name":"JSON Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false},"11":{"slot":11,"name":"S3 Bucket Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"13":{"slot":13,"name":"Compression Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${compression}"}}}},"visible":true},"14":{"slot":14,"name":"Encoding","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UTF8"}}}},"visible":true},"15":{"slot":15,"name":"Remove Quotes","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"16":{"slot":16,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"?"}}}},"visible":true},"17":{"slot":17,"name":"Maximum Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"18":{"slot":18,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"19":{"slot":19,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"20":{"slot":20,"name":"Ignore Header Rows","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"1"}}}},"visible":true},"21":{"slot":21,"name":"Accept Any Date","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"22":{"slot":22,"name":"Ignore Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"23":{"slot":23,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"24":{"slot":24,"name":"Fill Record","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"25":{"slot":25,"name":"Trim Blanks","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"26":{"slot":26,"name":"NULL As","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\\\\N"}}}},"visible":true},"27":{"slot":27,"name":"Empty As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"28":{"slot":28,"name":"Blanks As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"29":{"slot":29,"name":"Comp Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"30":{"slot":30,"name":"Stat Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"31":{"slot":31,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"32":{"slot":32,"name":"Round Decimals","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"33":{"slot":33,"name":"Manifest","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"34":{"slot":34,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true},"35":{"slot":35,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"36":{"slot":36,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"37":{"slot":37,"name":"Explicit IDs","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"38":{"slot":38,"name":"IAM Role ARN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"arn:aws:iam::<aws-account-id>:role/<role-name>"}}}},"visible":true},"112":{"slot":112,"name":"Avro Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877727":{"id":877727,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-457,"y":63,"width":32,"height":32,"inputConnectorIDs":[877742],"outputSuccessConnectorIDs":[877741],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim consent"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into consent.dim_consent (\n\n  accountid,\n  clientid,\n  purposeid,\n  consentprovided,\n  consentdate,\n  filename,\n  batchid\n)\n\n\n\n\nSELECT\n  stg.accountid,\n  ${clientid}    as clientid,\n  coalesce(dp.purposeid,1)as purposeid,\n  stg.consentprovided,\n  stg.updatedate AS consentdate,\n  '${filename}'  as filename,\n  '${BatchId}'   as batchid\nFROM loading.${stagetablename} AS stg\n  left  JOIN\n  consent.dim_purpose AS dp\n    ON lower(stg.purpose) = lower(dp.purpose) and active = true"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877728":{"id":877728,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1074,"y":-177,"width":32,"height":32,"inputConnectorIDs":[877743],"outputSuccessConnectorIDs":[877736],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get client id and chk if the file is gzip"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cursor = context.cursor()\nfname = filename.split('_')[0].lower()\ncursor.execute(\"select clientid ,name from consent.dim_client where lower(consent_file_prefix) = '%s' limit 1\" %fname )\ndata =cursor.fetchone()\n\nfile_ext = filename.split('.')[-1].lower()\n\nif file_ext =='gz':\n  compression ='GZip'\nelse:\n  compression ='None'\ncontext.updateVariable('clientid',int(data[0]) )\ncontext.updateVariable('compression',compression )\n\nprint clientid,filename,file_ext,compression"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877729":{"id":877729,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-600,"y":47,"width":32,"height":32,"inputConnectorIDs":[877739],"outputSuccessConnectorIDs":[877742],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_purpose"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into consent.dim_purpose(purpose,purposetypeid)\nSELECT\n  distinct lower(st.purpose) as purpose ,coalesce(dpt.purposetypeid,0) purposetypeid\nFROM \"loading\".${stagetablename} st\nleft join consent.dim_purpose dp\non lower(st.purpose) = lower(dp.purpose) and active = true\nleft join \n\t consent.dim_purpose_type dpt\n     on dp.purposetypeid = dpt.purposetypeid\nwhere dp.purposeid is null \n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877730":{"id":877730,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-342,"y":89,"width":32,"height":32,"inputConnectorIDs":[877741],"outputSuccessConnectorIDs":[877740],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fact_Consent"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fact_Consent"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877731":{"id":877731,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-921,"y":-134,"width":32,"height":32,"inputConnectorIDs":[877736],"outputSuccessConnectorIDs":[877738],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate stage table"}}}},"visible":true},"2":{"slot":2,"name":"Tables to Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stagetablename}"}}}},"visible":true},"3":{"slot":3,"name":"Schema ","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877732":{"id":877732,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-201,"y":113,"width":32,"height":32,"inputConnectorIDs":[877740],"outputSuccessConnectorIDs":[877735],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update status"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\t\ninsert into etl_inbound_log\n(processname, batchid, path, filename, rowcount, status, message)\nvalues ('${processname}','${BatchId}','${src_url}','${filename}',${rowcount},'${status}','${message}')\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877733":{"id":877733,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-100,"y":114,"width":32,"height":32,"inputConnectorIDs":[877735],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"move file to archive folder"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\ns3 = boto3.client('s3')\ns3_resource = boto3.resource('s3')\ncopy_source = {\n    'Bucket': src_url,\n    'Key': filename\n}\n\ns3_resource.meta.client.copy(copy_source, src_url, (archivefolderpath +filename))\ns3.delete_object(Bucket=src_url, Key=filename)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877734":{"id":877734,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-706,"y":-4,"width":32,"height":32,"inputConnectorIDs":[877737],"outputSuccessConnectorIDs":[877739],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"877741":{"id":877741,"sourceID":877727,"targetID":877730},"877740":{"id":877740,"sourceID":877730,"targetID":877732},"877742":{"id":877742,"sourceID":877729,"targetID":877727},"877737":{"id":877737,"sourceID":877726,"targetID":877734},"877736":{"id":877736,"sourceID":877728,"targetID":877731},"877739":{"id":877739,"sourceID":877734,"targetID":877729},"877738":{"id":877738,"sourceID":877731,"targetID":877726},"877735":{"id":877735,"sourceID":877732,"targetID":877733}},"failureConnectors":{},"unconditionalConnectors":{"877743":{"id":877743,"sourceID":877725,"targetID":877728}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"variables":{"compression":{"definition":{"name":"compression","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"None"},"rowcount":{"definition":{"name":"rowcount","type":"DECIMAL","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"0"},"message":{"definition":{"name":"message","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":""},"status":{"definition":{"name":"status","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"Copy of GDPR_Child_Job","description":"","type":"ORCHESTRATION"}}