{"job":{"components":{"877781":{"id":877781,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1184,"y":-215,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[877805],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877782":{"id":877782,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1449697230,"x":-828,"y":-57,"width":32,"height":32,"inputConnectorIDs":[877798],"outputSuccessConnectorIDs":[877797],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Row Count","mapTo":"rowcount"},"2":{"slot":2,"fromId":null,"fromName":"Message","mapTo":"message"},"3":{"slot":3,"fromId":null,"fromName":"Status","mapTo":"status"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load data from S3 to Stage table"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stagetablename}"}}}},"visible":true},"3":{"slot":3,"name":"Load Columns","elements":{},"visible":true},"4":{"slot":4,"name":"S3 URL Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://${src_url}"}}}},"visible":true},"5":{"slot":5,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${filename}"}}}},"visible":true},"6":{"slot":6,"name":"Data File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"7":{"slot":7,"name":"Fixed Width Spec","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":","}}}},"visible":true},"9":{"slot":9,"name":"CSV Quoter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\""}}}},"visible":true},"10":{"slot":10,"name":"JSON Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false},"11":{"slot":11,"name":"S3 Bucket Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"13":{"slot":13,"name":"Compression Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${compression}"}}}},"visible":true},"14":{"slot":14,"name":"Encoding","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UTF8"}}}},"visible":true},"15":{"slot":15,"name":"Remove Quotes","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"16":{"slot":16,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"?"}}}},"visible":true},"17":{"slot":17,"name":"Maximum Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"18":{"slot":18,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"19":{"slot":19,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"20":{"slot":20,"name":"Ignore Header Rows","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"1"}}}},"visible":true},"21":{"slot":21,"name":"Accept Any Date","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"22":{"slot":22,"name":"Ignore Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"23":{"slot":23,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"24":{"slot":24,"name":"Fill Record","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"25":{"slot":25,"name":"Trim Blanks","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"26":{"slot":26,"name":"NULL As","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\\\\N"}}}},"visible":true},"27":{"slot":27,"name":"Empty As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"28":{"slot":28,"name":"Blanks As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"29":{"slot":29,"name":"Comp Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"30":{"slot":30,"name":"Stat Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}}},"visible":true},"31":{"slot":31,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"32":{"slot":32,"name":"Round Decimals","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"33":{"slot":33,"name":"Manifest","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"34":{"slot":34,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true},"35":{"slot":35,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"36":{"slot":36,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"37":{"slot":37,"name":"Explicit IDs","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"38":{"slot":38,"name":"IAM Role ARN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"arn:aws:iam::<aws-account-id>:role/<role-name>"}}}},"visible":true},"112":{"slot":112,"name":"Avro Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877783":{"id":877783,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-448,"y":60,"width":32,"height":32,"inputConnectorIDs":[877803],"outputSuccessConnectorIDs":[877801],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim consent"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into consent.dim_consent (\n\n  accountid,\n  clientid,\n  client_purpose_id,\n  iab_purpose_id ,\n  consentprovided,\n  consentdate,\n  filename,\n  batchid\n)\n\n\n\n\nSELECT distinct \n  stg.accountid,\n  ${clientid}    as clientid,\n  coalesce(dp.client_purpose_id,0)as client_purpose_id,\n  coalesce(cpm.iab_purpose_id,0)as iab_purpose_id,\n  stg.consentprovided,\n  stg.updatedate AS consentdate,\n  '${filename}'  as filename,\n  '${BatchId}'   as batchid\nFROM loading.${stagetablename} AS stg\n  left  JOIN\n  consent.dim_client_purpose AS dp\n    ON lower(stg.purpose) = lower(dp.purpose) \n    left join  consent.iab_client_purpose_mapping  cpm\n    on dp.client_purpose_id = cpm.client_purpose_id and cpm.active = true"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877784":{"id":877784,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1074,"y":-177,"width":32,"height":32,"inputConnectorIDs":[877805],"outputSuccessConnectorIDs":[877796],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get client id and chk if the file is gzip"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cursor = context.cursor()\nfname = filename.split('/')[0].lower()\ncursor.execute(\"select clientid ,name from consent.dim_client where lower(consent_file_prefix) = '%s' limit 1\" %fname )\ndata =cursor.fetchone()\n\nfile_ext = filename.split('.')[-1].lower()\n\nif file_ext =='gz':\n  compression ='GZip'\nelse:\n  compression ='None'\ncontext.updateVariable('clientid',int(data[0]) )\ncontext.updateVariable('compression',compression )\n\nprint clientid,filename,file_ext,compression"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877785":{"id":877785,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-600,"y":47,"width":32,"height":32,"inputConnectorIDs":[877799],"outputSuccessConnectorIDs":[877803],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client_purpose and purpose_mapping"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into consent.dim_client_purpose(purpose)\nSELECT\n  distinct lower(st.purpose) as purpose \nFROM \"loading\".${stagetablename} st\nwhere not exists \n\t(\n      \tselect null \n      \tfrom \n      \tconsent.dim_client_purpose dcp where lower(st.purpose) = lower(dcp.purpose)\n\t) ;\n   \n--insert default purpose\ninsert into consent.iab_client_purpose_mapping( client_purpose_id ,iab_purpose_id)\nselect distinct cp.client_purpose_id , 1 as  iab_purpose_id  ---Storage and access of information\nfrom \"loading\".${stagetablename} sg\n  join consent.dim_client_purpose cp\n    on lower(sg.purpose) = lower(cp.purpose)\nwhere not exists(select null\n                 from consent.iab_client_purpose_mapping iab\n                 where cp.client_purpose_id =  iab.client_purpose_id\n                       and iab.iab_purpose_id = 1) ;\n\n\ninsert into consent.iab_client_purpose_mapping( client_purpose_id ,iab_purpose_id)\nselect distinct cp.client_purpose_id , 3  as  iab_purpose_id  --Ad selection, delivery, reporting\nfrom \"loading\".${stagetablename} sg\n  join consent.dim_client_purpose cp\n    on lower(sg.purpose) = lower(cp.purpose)\nwhere not exists(select null\n                 from consent.iab_client_purpose_mapping iab\n                 where cp.client_purpose_id = iab.client_purpose_id\n                       and iab.iab_purpose_id = 3); "}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877786":{"id":877786,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-342,"y":89,"width":32,"height":32,"inputConnectorIDs":[877801],"outputSuccessConnectorIDs":[877800],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fact_Consent"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fact_Consent"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877787":{"id":877787,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-921,"y":-134,"width":32,"height":32,"inputConnectorIDs":[877796],"outputSuccessConnectorIDs":[877798],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate stage table"}}}},"visible":true},"2":{"slot":2,"name":"Tables to Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stagetablename}"}}}},"visible":true},"3":{"slot":3,"name":"Schema ","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"loading"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877788":{"id":877788,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-201,"y":113,"width":32,"height":32,"inputConnectorIDs":[877800],"outputSuccessConnectorIDs":[877795],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update status"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\t\ninsert into etl_inbound_log\n(processname, batchid, path, filename, rowcount, status, message)\nvalues ('${processname}','${BatchId}','${src_url}','${filename}',${rowcount},'${status}','${message}')\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877789":{"id":877789,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-100,"y":114,"width":32,"height":32,"inputConnectorIDs":[877795],"outputSuccessConnectorIDs":[877802,877794],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"move file to archive folder"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\ns3_client = boto3.client('s3')\ns3_resource = boto3.resource('s3')\nbucket = s3_resource.Bucket(src_url)\ncopy_source = {\n    'Bucket': src_url,\n    'Key': filename\n}\n\nprint 'filename - to be deleted' ,filename\ns3_client.copy_object(CopySource = copy_source, Bucket = src_url, Key = (archivefolderpath +filename))\ns3_client.delete_object(Bucket = src_url, Key =filename )\ncontext.updateVariable('email_msg',(filename.split('/')[-1]) )"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877790":{"id":877790,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-706,"y":-4,"width":32,"height":32,"inputConnectorIDs":[877797],"outputSuccessConnectorIDs":[877799],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877791":{"id":877791,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-95,"y":290,"width":32,"height":32,"inputConnectorIDs":[877804],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 0"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${sns_topic}"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Consent file received and processed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FileName :  ${email_msg} "}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877792":{"id":877792,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-97,"y":195,"width":32,"height":32,"inputConnectorIDs":[877794],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[877804],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"If 0"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"send_email_flag"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"True"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"877793":{"id":877793,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-286,"y":279,"width":32,"height":32,"inputConnectorIDs":[877802],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"email_notificaton"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import json\nimport boto3\n\ncursor = context.cursor()\ncursor.execute(\"select SNS_Topic, Subject  \"+\n\" from etl_Email_Notification \"+\n\" where processname = '%s' limit 1\" %processname )\ndata =cursor.fetchone()\n\nclient = boto3.client('sns')\n\n\nemail_subject = \"Consent file received and processed\"\n\nif data is not None :\n  aws_sns_topic = data[0]\n  aws_email_subject =data[1]\n  aws_send_email_flag ='True'\n  aws_email_msg =(filename.split('/')[-1])  \n  aws_arn =\"arn:aws:sns:eu-west-1:239990938293:\" + aws_sns_topic\n  print (\"aws_arn : \" , aws_arn)\n  message = \"File name : \" +  (aws_email_msg)\n  \n  response = client.publish(\n    TargetArn= aws_arn,\n    Subject=email_subject,\n    Message=message\n  )\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"877801":{"id":877801,"sourceID":877783,"targetID":877786},"877800":{"id":877800,"sourceID":877786,"targetID":877788},"877803":{"id":877803,"sourceID":877785,"targetID":877783},"877802":{"id":877802,"sourceID":877789,"targetID":877793},"877797":{"id":877797,"sourceID":877782,"targetID":877790},"877796":{"id":877796,"sourceID":877784,"targetID":877787},"877799":{"id":877799,"sourceID":877790,"targetID":877785},"877798":{"id":877798,"sourceID":877787,"targetID":877782},"877795":{"id":877795,"sourceID":877788,"targetID":877789},"877794":{"id":877794,"sourceID":877789,"targetID":877792}},"failureConnectors":{},"unconditionalConnectors":{"877805":{"id":877805,"sourceID":877781,"targetID":877784}},"trueConnectors":{"877804":{"id":877804,"sourceID":877792,"targetID":877791}},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"variables":{"compression":{"definition":{"name":"compression","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"None"},"rowcount":{"definition":{"name":"rowcount","type":"DECIMAL","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":"0"},"message":{"definition":{"name":"message","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":""},"status":{"definition":{"name":"status","type":"TEXT","scope":"BRANCH","description":null,"visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"GDPR_Child_Job","description":"","type":"ORCHESTRATION"}}